<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS基础篇 | lancit の blog</title><meta name="author" content="lancit"><meta name="copyright" content="lancit"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ROS基础篇 ROS：robot operating system，是一款旨在为机器人研究和开发提供代码复用的支持。  ROS是一款分布式进程（也就是“节点”）框架。 支持多种语言，包括Java，C++，Python等。 大量的工具，库，协议。 优秀的进程通讯机制。  1. ROS的安装 ROS系统虽然叫做系统，但是其寄生于Linux系统之上，在学习期间，可以安装虚拟机进行学习。  虚拟机安装：V">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS基础篇">
<meta property="og:url" content="http://example.com/2024/05/18/ROS%E5%9F%BA%E7%A1%80%E7%AF%87/index.html">
<meta property="og:site_name" content="lancit の blog">
<meta property="og:description" content="ROS基础篇 ROS：robot operating system，是一款旨在为机器人研究和开发提供代码复用的支持。  ROS是一款分布式进程（也就是“节点”）框架。 支持多种语言，包括Java，C++，Python等。 大量的工具，库，协议。 优秀的进程通讯机制。  1. ROS的安装 ROS系统虽然叫做系统，但是其寄生于Linux系统之上，在学习期间，可以安装虚拟机进行学习。  虚拟机安装：V">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/ros.jpg">
<meta property="article:published_time" content="2024-05-18T07:33:14.000Z">
<meta property="article:modified_time" content="2024-06-14T01:35:45.750Z">
<meta property="article:author" content="lancit">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/ros.jpg"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="http://example.com/2024/05/18/ROS%E5%9F%BA%E7%A1%80%E7%AF%87/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS基础篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-14 09:35:45'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/theme_img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/linux/"><i class="fa-fw far fa-sad-cry"></i><span> LinuxC</span></a></li><li><a class="site-page child" href="/stm32/"><i class="fa-fw far fa-sad-tear"></i><span> STM32</span></a></li><li><a class="site-page child" href="/Hcircuit/"><i class="fa-fw far fa-meh"></i><span> Hcircuit</span></a></li><li><a class="site-page child" href="/other/"><i class="fa-fw far fa-kiss-wink-heart"></i><span> Other</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw far fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="lancit の blog"><img class="site-icon" src="/img/nav.svg"/><span class="site-name">lancit の blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/linux/"><i class="fa-fw far fa-sad-cry"></i><span> LinuxC</span></a></li><li><a class="site-page child" href="/stm32/"><i class="fa-fw far fa-sad-tear"></i><span> STM32</span></a></li><li><a class="site-page child" href="/Hcircuit/"><i class="fa-fw far fa-meh"></i><span> Hcircuit</span></a></li><li><a class="site-page child" href="/other/"><i class="fa-fw far fa-kiss-wink-heart"></i><span> Other</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw far fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ROS基础篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-18T07:33:14.000Z" title="发表于 2024-05-18 15:33:14">2024-05-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-14T01:35:45.750Z" title="更新于 2024-06-14 09:35:45">2024-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux/">linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS基础篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1>ROS基础篇</h1>
<p>ROS：robot operating system，是一款旨在为机器人研究和开发提供代码复用的支持。</p>
<ul>
<li>ROS是一款<strong>分布式进程（也就是“节点”）框架</strong>。</li>
<li>支持多种语言，包括Java，C++，Python等。</li>
<li>大量的工具，库，协议。</li>
<li>优秀的进程通讯机制。</li>
</ul>
<h2 id="1-ROS的安装">1. ROS的安装</h2>
<p>ROS系统虽然叫做系统，但是其寄生于Linux系统之上，在学习期间，可以安装虚拟机进行学习。</p>
<ul>
<li><strong>虚拟机安装</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_74195551/article/details/127288338">VMware</a></li>
<li><strong>Linux系统安装</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43233550/article/details/115417176">Ubuntu18.04</a></li>
<li><strong>VMtools</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hu_wei123/article/details/130514276">VMtools</a></li>
<li><strong>ROS安装</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44830040/article/details/106049992">Ubuntu18.04安装ROS Melodic</a></li>
</ul>
<hr>
<h2 id="2-ROS的使用">2. ROS的使用</h2>
<h3 id="2-1-简单使用">2.1 简单使用</h3>
<p>下面将演示基于<strong>终端Terminator</strong>的简单流程，也可以用vscode。</p>
<h4 id="2-1-1-安装Terminator">2.1.1 安装Terminator</h4>
<p>由于使用ros时需要打开多个ros终端，则可以安装终端分频工具，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install terminator</span><br></pre></td></tr></table></figure>
<p>对此，该工具常用的快捷键：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Ctrl+Shift+W                    //关闭当前终端</span><br><span class="line">Ctrl+Shift+O                    //水平分割终端</span><br><span class="line">Ctrl+Shift+E                    //垂直分割终端</span><br><span class="line">Ctrl+Shift+X                    //最大化显示当前终端</span><br><span class="line"></span><br><span class="line">Alt+Up                          //移动到上面的终端</span><br><span class="line">Alt+Down                        //移动到下面的终端</span><br><span class="line">Alt+Left                        //移动到左边的终端</span><br><span class="line">Alt+Right                       //移动到右边的终端</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-1-2-创建工程及依赖项">2.1.2 创建工程及依赖项</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p 自定义空间名称/src	<span class="comment"># 生成工作空间，其下有一个src目录，用于存放源代码</span></span><br><span class="line"><span class="built_in">cd</span> 自定义空间名称	<span class="comment"># 切换目录指令</span></span><br><span class="line">catkin_make	 <span class="comment"># 编译，即初始化</span></span><br><span class="line"><span class="built_in">cd</span> src	<span class="comment"># 进入src目录下</span></span><br><span class="line">catkin_create_pkg 自定义ROS包名 roscpp rospy std_msgs	<span class="comment"># 创建包，并为其添加依赖项：roscpp、rospy、std_msgs</span></span><br><span class="line"></span><br><span class="line">// 例：</span><br><span class="line"><span class="built_in">mkdir</span> -p lancit_ws/src</span><br><span class="line"><span class="built_in">cd</span> lancit_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">catkin_create_pkg pkg_hello roscpp rospy std_msgs</span><br></pre></td></tr></table></figure>
<p>打开终端，依次键入上述代码，将会完成：<strong>生成工作空间、进入工作空间、工作空间初始化，创建包及其依赖项</strong>。</p>
<ul>
<li><strong>roscpp</strong>：C++实现库</li>
<li><strong>rospy</strong>：python实现库</li>
<li><strong>std_msgs</strong>：标准消息库</li>
</ul>
<p><strong>图例</strong>：</p>
<p><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518161241284.png" alt="image-20240518161241284"></p>
<p><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518161517507.png" alt="image-20240518161517507"></p>
<p>安装<code>tree工具</code>，就可以在终端输出文件目录结构，然后我们输入<code>tree</code>，观察到对应文件目录下，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install tree</span><br></pre></td></tr></table></figure>
<p><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518161840031.png" alt="image-20240518161840031"></p>
<hr>
<h4 id="2-1-3-输出“Hello-World">2.1.3 输出“Hello World!&quot;</h4>
<p>下面演示使用<strong>C++实现“Hello World!&quot;</strong>。</p>
<ol>
<li><strong>新建<code>hello.cpp</code>文件</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> pkg_hello/src	<span class="comment"># 进入自己创建的包下的src目录下</span></span><br><span class="line"><span class="built_in">touch</span> hello.cpp		<span class="comment"># 新建源代码文件</span></span><br><span class="line">sudo gedit hello.cpp	<span class="comment"># 自带文本编辑器打开，并编辑代码</span></span><br></pre></td></tr></table></figure>
<p><strong>源码</strong>：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;print_hello&quot;</span>); <span class="comment">// 初始化节点，该节点名为print_hello</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;hello world!&quot;</span>); <span class="comment">// 在ros终端上显示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>对CMakeLists.txt编辑</strong></li>
</ol>
<p><strong>对src目录下的CMakeLists.txt文件进行编辑</strong>：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 位于137行，取消注释，作用：声明可执行文件，同时将hello.cpp映射到hello上</span></span><br><span class="line"><span class="keyword">add_executable</span>(hello</span><br><span class="line">  src/hello.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 位于150行，告诉Cmake当链接此可执行文件时需要链接哪些库，使用上述映射名</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(hello</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>编译</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> lancit_ws	<span class="comment"># 进入工作区</span></span><br><span class="line">catkin_make	<span class="comment"># 编译</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>执行</strong></li>
</ol>
<p><strong>打开Terminator，输入</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ./devel/setup.bash <span class="comment"># 刷新环境变量</span></span><br><span class="line">roscore</span><br></pre></td></tr></table></figure>
<p><strong>右击Terminator空白处，选择水平分割，即新开一终端</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ./devel/setup.bash	<span class="comment"># 设置环境变量</span></span><br><span class="line">rosrun pkg_hello hello	<span class="comment"># rosrun 包名 c++节点</span></span><br></pre></td></tr></table></figure>
<p><strong>结果：</strong></p>
<p><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518173349387.png" alt="image-20240518173349387"></p>
<hr>
<h3 id="2-2-ROS文件架构">2.2 ROS文件架构</h3>
<hr>
<h4 id="2-1-2-ROS-文件系统">2.1.2 ROS 文件系统</h4>
<p>ros文件系统，即<strong>ROS源代码组织形式</strong>，如：</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518184800452.png" alt="image-20240518184800452" style="zoom: 67%;" />
<ul>
<li><strong>catkin_workspace</strong>：工作区。</li>
<li><strong>build</strong>：<strong>编译空间，用于存放CMake和catkin的缓存信息、配置信息和其他中间文件。</strong></li>
<li><strong>devel</strong>：<strong>开发空间，用于存放编译后生成的目标文件，包括头文件、动态&amp;静态链接库、可执行文件等。</strong></li>
<li><strong>src</strong>：源码
<ul>
<li>package：功能包，包含多个节点、库与配置文件，<strong>包名所有字母小写，只能由字母、数字与下划线组成</strong>。
<ul>
<li><strong>CMakeLists.txt</strong>：<strong>配置编译规则</strong>，比如源文件、依赖项、目标文件。</li>
<li><strong>package.xml</strong>：<strong>包信息</strong>，比如：包名、版本、作者、依赖项… (以前版本是 manifest.xml)。</li>
<li><strong>scripts</strong>：<strong>存储python文件</strong>。</li>
<li><strong>msg</strong>：<strong>消息通信格式文件</strong>。</li>
<li><strong>srv</strong>：<strong>服务通信格式文件</strong>。</li>
<li><strong>include</strong>：头文件。</li>
<li><strong>launch</strong>：可一次性运行多个节点。</li>
<li><strong>src</strong>：<strong>存储C++文件</strong>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-1-3-package-xml文件详解">2.1.3 package.xml文件详解</h4>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 格式: 以前是 1，推荐使用格式 2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 包名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo01_hello_vscode<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 版本 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 描述信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The demo01_hello_vscode package<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 维护人员 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;xuzuo@todo.todo&quot;</span>&gt;</span>xuzuo<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 许可证信息，ROS核心组件默认 BSD --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 依赖的构建工具，这是必须的 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>catkin<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 指定构建此软件包所需的软件包 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 指定根据这个包构建库所需要的包 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 运行该程序包中的代码所需的程序包 --&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- The export tag contains other, unspecified, tags --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Other tools can request additional information be placed here --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-4-CMakeLists-txt文件详解">2.1.4 CMakeLists.txt文件详解</h4>
<p><strong>作用</strong>：决定功能包，要<strong>依赖哪些package，要编译生成哪些目标，如何编译</strong>等。</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>.<span class="number">2</span>) <span class="comment"># 所需cmake最低版本</span></span><br><span class="line"><span class="keyword">project</span>(demo01_hello_vscode) <span class="comment"># 包名称，会被 $&#123;PROJECT_NAME&#125; 的方式调用</span></span><br><span class="line"><span class="comment"># add_compile_options(-std=c++11) # 编译器选项</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>()				<span class="comment"># 找到编译需要的其他CMake/Catkin	package </span></span><br><span class="line"></span><br><span class="line">catkin_python_setup()		<span class="comment"># catkin新加宏，打开catkin的Python Module的支持</span></span><br><span class="line"></span><br><span class="line">add_message_files()			<span class="comment"># catkin新加宏，添加自定义Message文件 </span></span><br><span class="line"></span><br><span class="line">add_service_files()         <span class="comment"># catkin新加宏，添加自定义Service文件 </span></span><br><span class="line"></span><br><span class="line">add_action_files()          <span class="comment"># catkin新加宏，添加自定义Action文件 </span></span><br><span class="line"></span><br><span class="line">generate_message()			<span class="comment"># catkin新加宏，生成不同语言版本的msg/srv/action接口 </span></span><br><span class="line"></span><br><span class="line">catkin_package()			<span class="comment"># catkin新加宏，生成当前package的cmake配置，供依赖本包的其他软件包调用 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>()				<span class="comment"># 添加库并指出该库的源文件 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>()			<span class="comment"># 添加可执行文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_dependencies</span>()			<span class="comment"># 定义目标文件依赖于其他目标文件，确保其他目标已被构建 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>()		<span class="comment"># 链接</span></span><br><span class="line"></span><br><span class="line">catkin_add_gtest()			<span class="comment"># catkin新加宏，生成测试</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>()					<span class="comment"># 安装至本机</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<strong>cmakelist文件中函数的顺序不能随意交换。</strong></p>
</blockquote>
<h4 id="2-1-5-launch文件说明">2.1.5 .launch文件说明</h4>
<p>当我们运行多个程序（节点），需要开启多个终端，这样操作显然效率低下，故<strong>使用launch文件实现一次启动多个节点</strong>。</p>
<p>按照2.1.2内容，在包下新建launch文件夹，新建.launch文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;helloworld&quot;</span> <span class="attr">type</span>=<span class="string">&quot;demo_hello&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;t1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;key1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>node</strong>：包含某个节点。</li>
<li><strong>pkg</strong>：功能包。</li>
<li><strong>type</strong>：被运行的节点文件。</li>
<li><strong>name</strong>：给节点命名。</li>
<li><strong>output</strong>：输出信息。</li>
</ul>
<p>运行launch文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">roslaunch 包名 launch文件名</span><br></pre></td></tr></table></figure>
<p>例如，使用wheeltec科技的16线雷达，使用雷达驱动包，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">roslaunch lslidar_driver lslidar_c16.launch</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-1-6-文件系统指令">2.1.6 文件系统指令</h4>
<p>”一切基于文件“，对于ROS文件系统的操作都可以像对普通文件那样操作：<strong>增、删、查、改、执行</strong>。</p>
<ul>
<li><strong>增</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">catkin_create_pkg 自定义包名 依赖包		<span class="comment"># 创建新的ROS功能包</span></span><br><span class="line">sudo apt install xxx	<span class="comment"># 安装 ROS功能包</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>删</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt purge xxx <span class="comment"># 删除某个功能包</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>查</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rospack list <span class="comment"># 列出所有功能包</span></span><br><span class="line"></span><br><span class="line">rospack find 包名 <span class="comment"># 查找某个功能包是否存在，如果存在返回安装路径</span></span><br><span class="line"></span><br><span class="line">roscd 包名 <span class="comment"># 进入某个功能包</span></span><br><span class="line"></span><br><span class="line">rosls 包名 <span class="comment"># 列出某个包下的文件</span></span><br><span class="line"></span><br><span class="line">apt search xxx <span class="comment"># 搜索某个功能包</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>改</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rosed 包名 文件名 <span class="comment"># 修改功能包文件</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>执行</strong>：</p>
<ul>
<li><strong>roscore</strong>：<strong>启动主节点</strong>，同时输出的还有：<strong>rosout 和 parameter server</strong>,
<ul>
<li>rosout：日志输出。</li>
<li>parameter server：参数服务器，它并不是一个node，而是存储参数配置的一个服务器。</li>
<li>运行ros程序前都需要键入roscore，<strong>启动master后，node才能注册和通讯</strong>。</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">roscore 	<span class="comment"># 是ROS的系统先决条件节点和程序的集合，必须运行roscore才能使ROS节点进行通信。</span></span><br><span class="line">roscore 将启动:</span><br><span class="line">	ros master</span><br><span class="line">	ros 参数服务器</span><br><span class="line">	rosout 日志节点</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 用法：</span></span><br><span class="line">roscore 或 roscore -p xxxx	<span class="comment"># 指定端口</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>rosrun</strong>：运行<strong>某一节点</strong>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rosrun 包名 可执行文件名 <span class="comment"># 运行指定的ROS节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line">rosrun turtlesim turtlesim_node</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>roslaunch</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">roslaunch 包名 launch文件名 <span class="comment"># 执行某个包下的 launch 文件</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="2-1-7-计算图">2.1.7 计算图</h4>
<p>前面介绍的是ROS文件结构，是磁盘上 ROS 程序的存储结构，是<strong>静态的，而 ros 程序运行之后，不同的节点之间是错综复杂的，ROS 中提供了一个实用的工具:rqt_graph。</strong></p>
<p>rqt_graph能够创建一个显示当前系统运行情况的动态图形。ROS 分布式系统中**不同进程需要进行数据交互，计算图可以以点对点的网络形式表现数据交互过程。**rqt_graph是rqt程序包中的一部分。</p>
<ul>
<li><strong>安装</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install ros-&lt;distro&gt;-rqt</span><br><span class="line">sudo apt install ros-&lt;distro&gt;-rqt-common-plugins	<span class="comment"># &lt;distro&gt;换成对应的ubuntu版本，如：kinetic、melodic、Noetic</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>使用</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rosrun rqt_graph rqt_graph</span><br></pre></td></tr></table></figure>
<p><strong>例如，在下面使用话题通讯时，发送者节点<code>msgs_pub</code>通过话题<code>simple_chat</code>向订阅者节点<code>msgs_sub</code>发送数据：</strong></p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240520224659634.png" alt="image-20240520224659634" style="zoom:67%;" />
<hr>
<h3 id="2-3-ROS节点及函数">2.3 ROS节点及函数</h3>
<p>我参考了这位大佬的帖子，感谢！：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40626497/article/details/103744839">ROS节点</a></p>
<h4 id="2-3-1-ROS节点">2.3.1 ROS节点</h4>
<p>在ROS系统里，<strong>最小的进程单元就是节点（node）</strong>。</p>
<ul>
<li>一个软件包里<strong>可以有多个可执行文件，可执行文件在运行之后就成了一个进程(process)，这个进程在ROS中就叫做节点</strong>。</li>
<li>从程序角度来说，node就是一个<strong>可执行文件（通常为C++编译生成的可执行文件、Python脚本）被执行</strong>，加载到了内存之中。</li>
<li>从功能角度来说，通常<strong>一个node负责者机器人的某一个单独的功能</strong>。由于机器人的功能模块非常复杂，我们往往不会把所有功能都集中到一个node上，而会采用分布式的方式，把鸡蛋放到不同的篮子里。</li>
<li>例如有一个node来控制底盘轮子的运动，有一个node驱动摄像头获取图像，有一个node驱动激光雷达…</li>
</ul>
<p>如何管理这些繁杂的节点呢，ROS提供给我们的<strong>节点管master</strong>，master管理中心，<strong>主节点</strong>。</p>
<ul>
<li>node首先master处进行注册，<strong>之后master会将该node纳入整个ROS程序中</strong>。</li>
<li>node之间的通信也是先由<strong>master进行“牵线”，才能两两的进行点对点通信</strong>。</li>
<li>当ROS程序启动时，第一步首先启动master，由节点管理器处理依次启动node。</li>
</ul>
<p>查看节点，<strong>rosnode</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列出当前运行的node信息</span></span><br><span class="line">rosnode list</span><br><span class="line"><span class="comment"># 显示出node的详细信息</span></span><br><span class="line">rosnode info node_name</span><br><span class="line"><span class="comment"># 结束某个node</span></span><br><span class="line">rosnode <span class="built_in">kill</span> node_name</span><br><span class="line"><span class="comment"># 测试连接节点</span></span><br><span class="line">rosnode ping</span><br><span class="line"><span class="comment"># 列出在特定机器或列表机器上运行的节点</span></span><br><span class="line">rosnode machine</span><br><span class="line"><span class="comment"># 清除不可到达节点的注册信息</span></span><br><span class="line">rosnode cleanup</span><br><span class="line"><span class="comment"># 查看rosnode命令的用法</span></span><br><span class="line">rosnode <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="2-3-2-node函数">2.3.2 node函数</h4>
<ul>
<li>
<p><strong>ros::init()</strong>：初始化</p>
<ul>
<li>通过调用<code>ros::init()</code>函数来初始化node</li>
<li>此函数向ROS系统传递<strong>命令行参数</strong>、<strong>定义node名字</strong>及<strong>其它参数</strong></li>
<li>在调用roscpp其它函数前必须先调用<code>ros::init()</code>，其函数原型为：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ros::init</span><span class="params">(<span class="type">int</span> &amp;argc, <span class="type">char</span> **argv, <span class="type">const</span> std::string &amp;name, <span class="type">uint32_t</span> options=<span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ros::Publisher</strong>：发布消息，将节点设置成<strong>发布者</strong>，并将所发布主题的类型和名称告知节点管理器。</p>
</li>
<li>
<p><strong>ros::Subscriber</strong>：订阅消息，将节点设置成<strong>接收者</strong>，并将所接受主题的类型和名称告知节点管理器。</p>
</li>
<li>
<p><strong>ros::Rate loop_rate</strong>：循环速率</p>
</li>
<li>
<p><strong>ros::spin()</strong>：事件循环</p>
</li>
<li>
<p><strong>ros::spinOnce()</strong>：单次事件</p>
</li>
<li>
<p><strong>ros::start()</strong>：启动</p>
</li>
<li>
<p><strong>ros::shutdown()</strong>：关闭</p>
</li>
<li>
<p><strong>ros::ok()</strong>：当接受到ctrl+c 信号或者 <code>ros::shutdown()</code> 调用时，为false，终止运行节点。</p>
</li>
<li>
<p><strong>add_executable(pub_node src/pub_node.cpp)</strong>：最后执行文件节点名、源文件</p>
</li>
</ul>
<hr>
<h2 id="3-ROS通讯">3. ROS通讯</h2>
<p>ROS系统的每个节点都是一个进程，即<strong>分布式框架</strong>，为实现各节点之间的通讯，数据传输，需要进行节点通讯：</p>
<ul>
<li><strong>话题通讯</strong>：发布订阅</li>
<li><strong>服务通讯</strong>：请求响应</li>
<li><strong>参数服务器</strong>：参数共享</li>
</ul>
<h3 id="3-1-话题通讯">3.1 话题通讯</h3>
<h4 id="3-1-1-理论模型">3.1.1 理论模型</h4>
<p>该模型中涉及到三个角色:</p>
<ul>
<li><strong>ROS Master (管理者)</strong></li>
<li><strong>Talker (发布者)</strong></li>
<li><strong>Listener (订阅者)</strong></li>
</ul>
<p>ROS Master 负责保管 Talker 和 Listener 注册的信息，并匹配话题相同的 Talker 与 Listener，帮助 Talker 与 Listener 建立连接，连接建立后，Talker 可以发布消息，且发布的消息会被 Listener 订阅。</p>
<p>整个流程由以下步骤实现:</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240531151646449.png" alt="image-20240531151646449" style="zoom:80%;" />
<ol start="0">
<li><strong>Talker注册</strong></li>
</ol>
<p>Talker启动后，会通过RPC在 ROS Master 中注册自身信息，<strong>其中包含所发布消息的话题名称</strong>。ROS Master 会将节点的注册信息加入到注册表中。</p>
<ol>
<li><strong>Listener注册</strong></li>
</ol>
<p>Listener启动后，也会通过RPC在 ROS Master 中注册自身信息，<strong>包含需要订阅消息的话题名</strong>。ROS Master 会将节点的注册信息加入到注册表中。</p>
<ol start="2">
<li><strong>ROS Master实现信息匹配</strong></li>
</ol>
<p>ROS Master 会根据注册表中的信息匹配Talker 和 Listener，并通过<strong>RPC 向 Listener 发送 Talker 的 RPC 地址信息</strong>。</p>
<ol start="3">
<li><strong>Listener向Talker发送请求</strong></li>
</ol>
<p>Listener 根据接收到的 RPC 地址，通过 RPC 向 Talker 发送连接请求，传输订阅的<strong>话题名称、消息类型以及通信协议(TCP/UDP)。</strong></p>
<ol start="4">
<li><strong>Talker确认请求</strong></li>
</ol>
<p>Talker 接收到 Listener 的请求后，也是通过 RPC 向 Listener 确认连接信息，并发送自身的 <strong>TCP 地址信息</strong>。</p>
<ol start="5">
<li><strong>Listener与Talker件里连接</strong></li>
</ol>
<p>Listener 根据步骤4 返回的消息<strong>使用 TCP 与 Talker 建立网络连接。</strong></p>
<ol start="6">
<li><strong>Talker向Listener发送消息</strong></li>
</ol>
<p>连接建立后，Talker 开始向 Listener 发布消息。</p>
<blockquote>
<p>注意1:上述实现流程中，前五步使用的 RPC协议，最后两步使用的是 TCP 协议</p>
<p>注意2: Talker 与 Listener 的启动无先后顺序要求</p>
<p>注意3: Talker 与 Listener 都可以有多个</p>
<p>注意4: Talker 与 Listener 连接建立后，不再需要 ROS Master。也即，即便关闭ROS Master，Talker 与 Listern 照常通信。</p>
</blockquote>
<hr>
<h4 id="3-1-2-话题通讯简单操作-C">3.1.2 话题通讯简单操作 (C++)</h4>
<p><strong>需求:</strong></p>
<blockquote>
<p>编写发布订阅实现，要求发布方以10HZ(每秒10次)的频率发布文本消息，订阅方订阅消息并将消息内容打印输出。</p>
</blockquote>
<ol start="0">
<li><strong>新建包</strong>,</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="built_in">test</span>/src</span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">catkin_create_pkg pubsub roscpp rospy std_msgs</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>发布方</strong>，保存在<code>test/src/pubsub/src/pub_node.cpp</code>。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span> <span class="comment">// 普通文本类型的消息</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);	<span class="comment">// 设置编码</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;talker&quot;</span>);	<span class="comment">// 初始化，参数1、2为后期节点传值，参数3为节点名称（唯一）</span></span><br><span class="line">    ros::NodeHandle nh;		<span class="comment">// 实例化句柄，该类封装了一些ROS常用功能</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数1: 要发布到的话题</span></span><br><span class="line">    <span class="comment">// 参数2: 队列中最大保存的消息数，超出此阀值时，先进的先销毁(时间早的先销毁)</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>,<span class="number">10</span>);	<span class="comment">// 实例化发布者对象</span></span><br><span class="line">    </span><br><span class="line">    std_msgs::String msg;	<span class="comment">// 编写动态数据，msg.data = &quot;你好啊！！！&quot;;</span></span><br><span class="line">    std::string msg_front = <span class="string">&quot;Hello 你好！&quot;</span>; <span class="comment">// 消息前缀</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>; <span class="comment">// 消息计数器</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;    <span class="comment">// 逻辑(一秒1次)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())    <span class="comment">// 节点不死</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::stringstream ss;        <span class="comment">// 使用 stringstream 拼接字符串与编号</span></span><br><span class="line">        ss &lt;&lt; msg_front &lt;&lt; count;</span><br><span class="line">        msg.data = ss.<span class="built_in">str</span>();</span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);	<span class="comment">// 发布消息</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;发送的消息:%s&quot;</span>,msg.data.<span class="built_in">c_str</span>());	<span class="comment">// 打印调试信息</span></span><br><span class="line">        r.<span class="built_in">sleep</span>();        <span class="comment">// 根据前面制定的发送频率自动休眠，休眠时间 = 1/频率；</span></span><br><span class="line">        count++;	<span class="comment">// 循环结束前，让 count 自增</span></span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();        <span class="comment">// 调用回调函数后，可继续向下执行，可搭配Rate sleep实现自定义监听频率。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>订阅方</strong>，保存在<code>test/src/pubsub/src/sub_node.cpp</code>。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doMsg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr&amp; msg_p)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;我听见:%s&quot;</span>,msg_p-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// ROS_INFO(&quot;我听见:%s&quot;,(*msg_p).data.c_str());</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>  *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;listener&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chatter&quot;</span>,<span class="number">10</span>,doMsg);</span><br><span class="line">    ros::<span class="built_in">spin</span>();	<span class="comment">// 循环读取接收的数据，并调用回调函数处理，不回向下执行</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>配置 CMakeLists.txt</strong>，记住一定是包下src中的。</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(pub_node</span><br><span class="line">  src/pub_node.cpp</span><br><span class="line">)</span><br><span class="line"><span class="keyword">add_executable</span>(sub_node</span><br><span class="line">  src/sub_node.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(pub_node</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(sub_node</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>执行</strong></li>
</ol>
<ul>
<li>在工作空间根目录编译：catkin_make。</li>
<li>键入<code>echo &quot;source ~/ros_workspace/devel/setup.bash&quot; &gt;&gt; ~/.bashrc</code>，下次使用直接<code>source ~/.bashrc</code>。</li>
<li>键入<code>roscore</code>，启动主节点。</li>
<li>分屏两个终端，依次输入<code>rosrun pubsub pub_node</code>、<code>rosrun pubsub sub_node</code>。</li>
<li>结果：</li>
</ul>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518223550921.png" alt="image-20240518223550921" style="zoom: 80%;" />
<p>此时工作目录：</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240518223945114.png" alt="image-20240518223945114" style="zoom:67%;" />
<ol start="5">
<li><strong>注意</strong></li>
</ol>
<blockquote>
<p>注意1：不要忘记新建包是在src目录下新建的。</p>
</blockquote>
<hr>
<h4 id="3-1-3-自定义msg">3.1.3 自定义msg</h4>
<p>在上面我们通过std_msgs实现了简单文本数据的发送，下面我们演示怎样自定义数据结构。</p>
<p>在 ROS 通信协议中，<strong>数据载体是一个较为重要组成部分，ROS 中通过 std_msgs 封装了一些原生的数据类型。</strong></p>
<ul>
<li>例如：<strong>String、Int32、Int64、Char、Bool、Empty…</strong></li>
<li>但是，这些数据一般<strong>只包含一个 data 字段</strong>，结构的单一意味着功能上的局限性，当传输一些复杂的数据，</li>
<li>比如: 激光雷达的信息…  std_msgs 由于描述性较差而显得力不从心，这种场景下可以使用自定义的消息类型。</li>
</ul>
<p>msgs只是<strong>简单的文本文件，每行具有字段类型和字段名称</strong>，可以使用的字段类型有：</p>
<ul>
<li><em><em>int8, int16, int32, int64 (或者无符号类型: uint</em>)</em>*</li>
<li>float32, float64</li>
<li><strong>string</strong></li>
<li>time, duration</li>
<li>other msg files</li>
<li>variable-length array[] and fixed-length array[C]</li>
<li><strong>header</strong></li>
</ul>
<p>ROS中还有一种特殊类型：<code>Header</code>，<strong>标头包含时间戳和ROS中常用的坐标帧信息</strong>，会经常看到msg文件的第一行具有<code>Header标头</code>。</p>
<p>**自定义数据：**姓名、身高、年龄等。</p>
<p><strong>流程：</strong></p>
<ol start="0">
<li>新建功能包</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p demo/demo31/src</span><br><span class="line"><span class="built_in">cd</span> demo/demo31</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">ctakin_create_pkg demo_msgs roscpp rospy std_msgs</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>定义msg文件</strong></li>
</ol>
<p>功能包下新建 msg 目录，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> demo_msgs</span><br><span class="line"><span class="built_in">mkdir</span> msg</span><br><span class="line">code .</span><br></pre></td></tr></table></figure>
<p>添加文件 Person.msg，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">string name</span><br><span class="line">uint16 age</span><br><span class="line">float64 height</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>编辑配置文件</strong></li>
</ol>
<p>**package.xml **中添加编译依赖与执行依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">exce_depend 以前对应的是 run_depend 现在非法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>**CMakeLists.txt **中编辑 msg 相关配置</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation, 必须有 std_msgs</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 配置 msg 源文件</span></span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成消息时依赖于 std_msgs</span></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES demo02_talker_listener</span></span><br><span class="line">  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>编译</strong></li>
</ol>
<p><strong>编译后的中间文件查看:</strong></p>
<p>C++ 需要调用的中间文件(…/工作空间/devel/include/包名/xxx.h)</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240519145059593.png" alt="image-20240519145059593" style="zoom: 80%;" />
<ul>
<li>
<p>Python 需要调用的中间文件(…/工作空间/devel/lib/python3/dist-packages/包名/msg)。</p>
</li>
<li>
<p>后续调用相关 msg 时，是从这些中间文件调用的。</p>
</li>
</ul>
<hr>
<h4 id="3-1-4-自定义话题通讯-C">3.1.4 自定义话题通讯 (C++)</h4>
<p><strong>需求:</strong></p>
<blockquote>
<p>编写发布订阅实现，要求发布方以10HZ(每秒10次)的频率发布自定义消息，订阅方订阅自定义消息并将消息内容打印输出。</p>
</blockquote>
<p><strong>流程:</strong></p>
<ol start="0">
<li><strong>vscode 配置</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> demo/demo31</span><br><span class="line">code .</span><br></pre></td></tr></table></figure>
<p>避免报错，配置<code>.vscode</code>下的 c_cpp_properties.json 的 includepath属性:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;browse&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;databaseFilename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;limitSymbolsToIncludedHeaders&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;/opt/ros/noetic/include/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;/usr/include/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;/xxx/yyy工作空间/devel/include/**&quot;</span> <span class="comment">//配置 head 文件的路径 </span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ROS&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gcc-x64&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/gcc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++17&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><strong>发布方</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo02_talker_listener/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;talker_person&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;demo02_talker_listener::Person&gt;(<span class="string">&quot;chatter_person&quot;</span>,<span class="number">1000</span>);</span><br><span class="line">    demo02_talker_listener::Person p;</span><br><span class="line">    p.name = <span class="string">&quot;sunwukong&quot;</span>;</span><br><span class="line">    p.age = <span class="number">2000</span>;</span><br><span class="line">    p.height = <span class="number">1.45</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        pub.<span class="built_in">publish</span>(p);</span><br><span class="line">        p.age += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;我叫:%s,今年%d岁,高%.2f米&quot;</span>, p.name.<span class="built_in">c_str</span>(), p.age, p.height);</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>订阅方</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo02_talker_listener/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPerson</span><span class="params">(<span class="type">const</span> demo02_talker_listener::Person::ConstPtr&amp; person_p)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;订阅的人信息:%s, %d, %.2f&quot;</span>, person_p-&gt;name.<span class="built_in">c_str</span>(), person_p-&gt;age, person_p-&gt;height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;listener_person&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;demo02_talker_listener::Person&gt;(<span class="string">&quot;chatter_person&quot;</span>,<span class="number">10</span>,doPerson);</span><br><span class="line">    ros::<span class="built_in">spin</span>();    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>配置 CMakeLists.txt</strong></li>
</ol>
<p>需要添加 <strong>add_dependencies</strong> 用以设置所依赖的消息相关的中间文件，注意位置，在catkin_package后。</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(talker src/talker.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(listener src/listener.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_dependencies</span>(talker <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br><span class="line"><span class="keyword">add_dependencies</span>(listener <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(talker</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(istener</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>执行</strong></li>
</ol>
<ul>
<li>在工作空间根目录编译：catkin_make。</li>
<li>键入<code>echo &quot;source ~/demo/demo31/devel/setup.bash&quot; &gt;&gt; ~/.bashrc</code>，下次使用直接<code>source ~/.bashrc</code>。</li>
<li>键入<code>roscore</code>，启动主节点。</li>
<li>分屏两个终端，依次输入<code>rosrun pubsub pub_node</code>、<code>rosrun pubsub sub_node</code>。</li>
<li>结果：</li>
</ul>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240519155938058.png" alt="image-20240519155938058" style="zoom: 80%;" />
<p>此时src目录：</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240519160203652.png" alt="image-20240519160203652" style="zoom:80%;" />
<hr>
<h3 id="3-2-服务通讯">3.2 服务通讯</h3>
<p>服务通信是基于<strong>请求响应</strong>模式的，是一种应答机制。</p>
<h4 id="3-2-1-理论模型">3.2.1 理论模型</h4>
<p>服务通信较之于话题通信更简单些，该模型中涉及到三个角色:</p>
<ul>
<li>ROS master(管理者)， <strong>负责保管 Server 和 Client 注册的信息，并匹配话题相同的 Server 与 Client ，。</strong></li>
<li>Server(服务端)，<strong>Server 返回响应信息。</strong></li>
<li>Client(客户端)，<strong>Client 发送请求信息。</strong></li>
</ul>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240531151610361.png" alt="image-20240531151610361" style="zoom:80%;" />
<p>整个流程由以下步骤实现:</p>
<ol start="0">
<li><strong>Server注册</strong></li>
</ol>
<p>Server 启动后，会通过RPC在 ROS Master 中注册自身信息，其中包含提供的服务的名称。ROS Master 会将节点的注册信息加入到注册表中。</p>
<ol>
<li><strong>Client注册</strong></li>
</ol>
<p>Client 启动后，也会通过RPC在 ROS Master 中注册自身信息，包含需要请求的服务的名称。ROS Master 会将节点的注册信息加入到注册表中。</p>
<ol start="2">
<li><strong>ROS Master实现信息匹配</strong></li>
</ol>
<p>ROS Master 会根据注册表中的信息匹配Server和 Client，并通过 RPC 向 Client 发送 Server 的 <strong>TCP</strong> 地址信息。</p>
<ol start="3">
<li><strong>Client发送请求</strong></li>
</ol>
<p>Client 根据步骤2 响应的信息，使用 TCP 与 Server 建立网络连接，并发送请求数据。</p>
<ol start="4">
<li><strong>Server发送响应</strong></li>
</ol>
<p>Server 接收、解析请求的数据，并产生响应结果返回给 Client。</p>
<blockquote>
<p>注意:</p>
<p>1.客户端请求被处理时，需要保证服务器已经启动；</p>
<p>2.服务端和客户端都可以存在多个。</p>
</blockquote>
<hr>
<h4 id="3-2-2-自定义srv">3.2.2 自定义srv</h4>
<p><strong>需求:</strong></p>
<blockquote>
<p>服务通信中，客户端提交两个整数至服务端，服务端求和并响应结果到客户端，请创建服务器与客户端通信的数据载体。</p>
</blockquote>
<ol start="0">
<li><strong>新建功能包</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p demo/demo32/src</span><br><span class="line"><span class="built_in">cd</span> demo/demo32</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">ctakin_create_pkg demo_msgs roscpp rospy std_msgs</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>定义srv文件</strong></li>
</ol>
<p>功能包下新建 srv 目录，添加 test_msgs.srv 文件，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> demo_msgs</span><br><span class="line"><span class="built_in">mkdir</span> srv</span><br><span class="line">code .</span><br></pre></td></tr></table></figure>
<p>服务通信中，数据分成两部分：<strong>请求与响应，用<code>---</code>分割，</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 客户端请求时发送的两个数字</span><br><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---</span><br><span class="line"># 服务器响应发送的数据</span><br><span class="line">int32 sum</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>编辑配置文件</strong></li>
</ol>
<p><strong>package.xml</strong> 中添加编译依赖与执行依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>CMakeLists.txt</strong> 编辑 srv 相关配置</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 需要加入 message_generation,必须有 std_msgs</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新定义宏，添加自定义service文件</span></span><br><span class="line">add_service_files(</span><br><span class="line">  FILES</span><br><span class="line">  AddInts.srv</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新定义宏，添加msgs/srv/action接口</span></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES demo02_talker_listener</span></span><br><span class="line">  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: 官网没有在 catkin_package 中配置 message_runtime，经测试配置也可以。</p>
</blockquote>
<ol start="3">
<li><strong>编译</strong></li>
</ol>
<ul>
<li>跟自定义msg一样的，下面展示目录结构，</li>
</ul>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240519170709543.png" alt="image-20240519170709543" style="zoom:80%;" />
<hr>
<h4 id="3-2-3-自定义服务通讯-c">3.2.3 自定义服务通讯 (c++)</h4>
<ol>
<li><strong>服务端</strong>，保存为<code>src/AddInts_Server.cpp</code>。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: </span></span><br><span class="line"><span class="comment">        编写两个节点实现服务通信，客户端节点需要提交两个整数到服务器</span></span><br><span class="line"><span class="comment">        服务器需要解析客户端提交的数据，相加后，将结果响应回客户端，</span></span><br><span class="line"><span class="comment">        客户端再解析</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 服务 对象</span></span><br><span class="line"><span class="comment">        5.回调函数处理请求并产生响应</span></span><br><span class="line"><span class="comment">        6.由于请求有多个，需要调用 ros::spin()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo_msgs/AddInts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bool 返回值由于标志是否处理成功</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">doReq</span><span class="params">(demo_msgs::AddInts::Request&amp; req,</span></span></span><br><span class="line"><span class="params"><span class="function">          demo_msgs::AddInts::Response&amp; resp)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> num1 = req.num1;</span><br><span class="line">    <span class="type">int</span> num2 = req.num2;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;服务器接收到的请求数据为:num1 = %d, num2 = %d&quot;</span>,num1, num2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (num1 &lt; <span class="number">0</span> || num2 &lt; <span class="number">0</span>)    <span class="comment">//逻辑处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;提交的数据异常:数据不可以为负数&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果没有异常，那么相加并将结果赋值给 resp</span></span><br><span class="line">    resp.sum = num1 + num2;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;AddInts_Server&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建 服务 对象</span></span><br><span class="line">    ros::ServiceServer server = nh.<span class="built_in">advertiseService</span>(<span class="string">&quot;AddInts&quot;</span>,doReq);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;服务已经启动....&quot;</span>);</span><br><span class="line">    <span class="comment">//     5.回调函数处理请求并产生响应</span></span><br><span class="line">    <span class="comment">//     6.由于请求有多个，需要调用 ros::spin()</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>客户端</strong>，保存为<code>src/AddInts_Client.cpp</code>。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 客户端 对象</span></span><br><span class="line"><span class="comment">        5.请求服务，接收响应</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo_msgs/AddInts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 调用时动态传值,如果通过 launch 的 args 传参，需要传递的参数个数 +3</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">    <span class="comment">// if (argc != 5)//launch 传参(0-文件路径 1传入的参数 2传入的参数 3节点名称 4日志路径)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;请提交两个整数&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;AddInts_Client&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建客户端对象</span></span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;demo_msgs::AddInts&gt;(<span class="string">&quot;AddInts&quot;</span>);</span><br><span class="line">    <span class="comment">//等待服务启动成功</span></span><br><span class="line">    <span class="comment">//方式1</span></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;AddInts&quot;</span>);</span><br><span class="line">    <span class="comment">//方式2：client.waitForExistence();</span></span><br><span class="line">    </span><br><span class="line">    demo_msgs::AddInts ai;    <span class="comment">// 组织请求数据</span></span><br><span class="line">    ai.request.num1 = <span class="built_in">atoi</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    ai.request.num2 = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(ai);    <span class="comment">// 发送请求,返回 bool 值，标记是否成功</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (flag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;请求正常处理,响应结果:%d&quot;</span>,ai.response.sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;请求处理失败....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>配置 CMakeLists.txt</strong></li>
</ol>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(AddInts_Server src/AddInts_Server.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(AddInts_Client src/AddInts_Client.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_dependencies</span>(AddInts_Server <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br><span class="line"><span class="keyword">add_dependencies</span>(AddInts_Client <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(AddInts_Server</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(AddInts_Client</span><br><span class="line">  <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>执行</strong></li>
</ol>
<ul>
<li>需要先启动服务：<code>rosrun 包名 服务</code></li>
<li>然后再调用客户端 ：<code>rosrun 包名 客户端 参数1 参数2</code></li>
</ul>
<p><strong>结果:</strong></p>
<p><strong>优化:</strong></p>
<ul>
<li>
<p>在客户端发送请求前添加:<code>client.waitForExistence();</code></p>
</li>
<li>
<p>或:<code>ros::service::waitForService(&quot;AddInts&quot;);</code></p>
</li>
<li>
<p>这是一个阻塞式函数，只有服务启动成功后才会继续执行。</p>
</li>
<li>
<p>此处可以使用 launch 文件优化，但是需要注意 args 传参特点。</p>
</li>
</ul>
<hr>
<h3 id="3-3-参数通讯">3.3 参数通讯</h3>
<h4 id="3-3-1-理论模型">3.3.1 理论模型</h4>
<p>参数服务器实现是最为简单的，该模型如下图所示,该模型中涉及到三个角色:</p>
<ul>
<li><strong>ROS Master (管理者)</strong></li>
<li><strong>Talker (参数设置者)</strong></li>
<li><strong>Listener (参数调用者)</strong></li>
</ul>
<p>ROS Master 作为一个公共容器保存参数，Talker 可以向容器中设置参数，Listener 可以获取参数。</p>
<img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/LitN/image-20240531151726649.png" alt="image-20240531151726649" style="zoom: 67%;" />
<p>整个流程由以下步骤实现:</p>
<ol>
<li><strong>Talker 设置参数</strong></li>
</ol>
<p>Talker 通过 RPC 向参数服务器发送参数(包括参数名与参数值)，ROS Master 将参数保存到参数列表中。</p>
<ol start="2">
<li><strong>Listener 获取参数</strong></li>
</ol>
<p>Listener 通过 RPC 向参数服务器发送参数查找请求，请求中包含要查找的参数名。</p>
<ol start="3">
<li><strong>ROS Master 向 Listener 发送参数值</strong></li>
</ol>
<p>ROS Master 根据步骤2请求提供的参数名查找参数值，并将查询结果通过 RPC 发送给 Listener。</p>
<p>参数可使用数据类型:</p>
<ul>
<li>32-bit integers</li>
<li>booleans</li>
<li>strings</li>
<li>doubles</li>
<li>iso8601 dates</li>
<li>lists</li>
<li>base64-encoded binary data</li>
<li>字典</li>
</ul>
<blockquote>
<p>注意:参数服务器不是为高性能而设计的，因此最好用于存储静态的非二进制的简单数据</p>
</blockquote>
<hr>
<h4 id="3-3-2-参数通讯-c">3.3.2 参数通讯 (c++)</h4>
<p>**需求：**实现参数服务器参数的增删改查操作。</p>
<p>在 C++ 中实现参数服务器数据的增删改查，可以通过两套 API 实现:</p>
<ul>
<li><strong>ros::NodeHandle</strong></li>
<li><strong>ros::param</strong></li>
</ul>
<p>下面为具体操作演示，</p>
<ol>
<li><strong>参数服务器新增(修改)参数</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数服务器操作之新增与修改(二者API一样)_C++实现:</span></span><br><span class="line"><span class="comment">    在 roscpp 中提供了两套 API 实现参数操作</span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment">        setParam(&quot;键&quot;,值)</span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        set(&quot;键&quot;,&quot;值&quot;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    示例:分别设置整形、浮点、字符串、bool、列表、字典等类型参数</span></span><br><span class="line"><span class="comment">        修改(相同的键，不同的值)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;set_update_param&quot;</span>);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt; stus;</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">&quot;孙大脑袋&quot;</span>);</span><br><span class="line"></span><br><span class="line">    std::map&lt;std::string,std::string&gt; friends;</span><br><span class="line">    friends[<span class="string">&quot;guo&quot;</span>] = <span class="string">&quot;huang&quot;</span>;</span><br><span class="line">    friends[<span class="string">&quot;yuang&quot;</span>] = <span class="string">&quot;xiao&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//NodeHandle--------------------------------------------------------</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_int&quot;</span>,<span class="number">10</span>); <span class="comment">//整型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_double&quot;</span>,<span class="number">3.14</span>); <span class="comment">//浮点型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_bool&quot;</span>,<span class="literal">true</span>); <span class="comment">//bool</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_string&quot;</span>,<span class="string">&quot;hello NodeHandle&quot;</span>); <span class="comment">//字符串</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_vector&quot;</span>,stus); <span class="comment">// vector</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_map&quot;</span>,friends); <span class="comment">// map</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改演示(相同的键，不同的值)</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">&quot;nh_int&quot;</span>,<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//param--------------------------------------------------------</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_int&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_double&quot;</span>,<span class="number">3.14</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_string&quot;</span>,<span class="string">&quot;Hello Param&quot;</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_bool&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_vector&quot;</span>,stus);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_map&quot;</span>,friends);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改演示(相同的键，不同的值)</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">&quot;param_int&quot;</span>,<span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>参数服务器获取参数</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数服务器操作之查询_C++实现:</span></span><br><span class="line"><span class="comment">    在 roscpp 中提供了两套 API 实现参数操作</span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        param(键,默认值) </span></span><br><span class="line"><span class="comment">            存在，返回对应结果，否则返回默认值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParam(键,存储结果的变量)</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParamCached键,存储结果的变量)--提高变量获取效率</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            若果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParamNames(std::vector&lt;std::string&gt;)</span></span><br><span class="line"><span class="comment">            获取所有的键,并存储在参数 vector 中 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        hasParam(键)</span></span><br><span class="line"><span class="comment">            是否包含某个键，存在返回 true，否则返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        searchParam(参数1，参数2)</span></span><br><span class="line"><span class="comment">            搜索键，参数1是被搜索的键，参数2存储搜索结果的变量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::param ----- 与 NodeHandle 类似</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;get_param&quot;</span>);</span><br><span class="line"></span><br><span class="line">    */</span><br><span class="line">    <span class="comment">//param--------------------------------------------------------</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;++++++++++++++++++++++++++++++++++++++++&quot;</span>);</span><br><span class="line">    <span class="type">int</span> res3 = ros::param::<span class="built_in">param</span>(<span class="string">&quot;param_int&quot;</span>,<span class="number">20</span>); <span class="comment">//存在</span></span><br><span class="line">    <span class="type">int</span> res4 = ros::param::<span class="built_in">param</span>(<span class="string">&quot;param_int2&quot;</span>,<span class="number">20</span>); <span class="comment">// 不存在返回默认</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;param获取结果:%d,%d&quot;</span>,res3,res4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParam 函数</span></span><br><span class="line">    <span class="type">int</span> param_int_value;</span><br><span class="line">    <span class="type">double</span> param_double_value;</span><br><span class="line">    <span class="type">bool</span> param_bool_value;</span><br><span class="line">    std::string param_string_value;</span><br><span class="line">    std::vector&lt;std::string&gt; param_stus;</span><br><span class="line">    std::map&lt;std::string, std::string&gt; param_friends;</span><br><span class="line"></span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_int&quot;</span>,param_int_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_double&quot;</span>,param_double_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_bool&quot;</span>,param_bool_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_string&quot;</span>,param_string_value);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_vector&quot;</span>,param_stus);</span><br><span class="line">    ros::param::<span class="built_in">get</span>(<span class="string">&quot;param_map&quot;</span>,param_friends);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;getParam获取的结果:%d,%.2f,%s,%d&quot;</span>,</span><br><span class="line">            param_int_value,</span><br><span class="line">            param_double_value,</span><br><span class="line">            param_string_value.<span class="built_in">c_str</span>(),</span><br><span class="line">            param_bool_value</span><br><span class="line">            );</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;stu : param_stus)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;stus 元素:%s&quot;</span>,stu.<span class="built_in">c_str</span>());        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;f : param_friends)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;map 元素:%s = %s&quot;</span>,f.first.<span class="built_in">c_str</span>(), f.second.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParamCached()</span></span><br><span class="line">    ros::param::<span class="built_in">getCached</span>(<span class="string">&quot;param_int&quot;</span>,param_int_value);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;通过缓存获取数据:%d&quot;</span>,param_int_value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getParamNames()</span></span><br><span class="line">    std::vector&lt;std::string&gt; param_names2;</span><br><span class="line">    ros::param::<span class="built_in">getParamNames</span>(param_names2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;name : param_names2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;名称解析name = %s&quot;</span>,name.<span class="built_in">c_str</span>());        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;存在 param_int 吗? %d&quot;</span>,ros::param::<span class="built_in">has</span>(<span class="string">&quot;param_int&quot;</span>));</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;存在 param_intttt 吗? %d&quot;</span>,ros::param::<span class="built_in">has</span>(<span class="string">&quot;param_intttt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    std::string key;</span><br><span class="line">    ros::param::<span class="built_in">search</span>(<span class="string">&quot;param_int&quot;</span>,key);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;搜索键:%s&quot;</span>,key.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>参数服务器删除参数</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    参数服务器操作之删除_C++实现:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment">        deleteParam(&quot;键&quot;)</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        del(&quot;键&quot;)</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;delete_param&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="type">bool</span> r1 = nh.<span class="built_in">deleteParam</span>(<span class="string">&quot;nh_int&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;nh 删除结果:%d&quot;</span>,r1);</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> r2 = ros::param::<span class="built_in">del</span>(<span class="string">&quot;param_int&quot;</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;param 删除结果:%d&quot;</span>,r2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-4-常用命令">3.4 常用命令</h3>
<p>当需要自定义节点和其他某个已经存在的节点通信时，如何获取对方的话题、以及消息载体的格式呢？</p>
<p>如下：</p>
<ul>
<li><strong>rosnode</strong> : 操作节点</li>
<li><strong>rostopic</strong> : 操作话题</li>
<li><strong>rosservice</strong> : 操作服务</li>
<li><strong>rosmsg</strong> : 操作msg消息</li>
<li><strong>rossrv</strong> : 操作srv消息</li>
<li><strong>rosparam</strong> : 操作参数</li>
</ul>
<p><strong>可以使用<code>-h</code>选项获取更多帮助。</strong></p>
<p>上述命令是动态的。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://lancit.top">lancit</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://lancit.top">https://lancit.top</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">此文章版权归lancit所有，如有转载，请注明来自原作者。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ROS/">ROS</a></div><div class="post_share"><div class="social-share" data-image="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/ros.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/08/Kalman%E6%BB%A4%E6%B3%A2%E8%AF%A6%E8%A7%A3/" title="Kalman滤波详解"><img class="cover" src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/kalman.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kalman滤波详解</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/28/PurePursuit%E7%AE%97%E6%B3%95/" title="PurePursuit算法"><img class="cover" src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/pursuit.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">PurePursuit算法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/28/PurePursuit%E7%AE%97%E6%B3%95/" title="PurePursuit算法"><img class="cover" src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/pursuit.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-28</div><div class="title">PurePursuit算法</div></div></a></div><div><a href="/2024/05/30/ROS%E6%8F%90%E9%AB%98%E7%AF%87/" title="ROS提高篇"><img class="cover" src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/ros1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="title">ROS提高篇</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/theme_img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">lancit</div><div class="author-info__description">车马很慢，阳光很暖。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lancitx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lancitx" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:ukio169@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">天道酬勤，欢迎志同道合的友友~ <img style="max-width:100%;overflow:hidden;" src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/an_img/sunny.gif" alt=""></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">ROS基础篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ROS%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">1. ROS的安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ROS%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2. ROS的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-text">2.1 简单使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%AE%89%E8%A3%85Terminator"><span class="toc-text">2.1.1 安装Terminator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B%E5%8F%8A%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-text">2.1.2 创建工程及依赖项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E8%BE%93%E5%87%BA%E2%80%9CHello-World"><span class="toc-text">2.1.3 输出“Hello World!&quot;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-ROS%E6%96%87%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="toc-text">2.2 ROS文件架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-ROS-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.1.2 ROS 文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-package-xml%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">2.1.3 package.xml文件详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-CMakeLists-txt%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">2.1.4 CMakeLists.txt文件详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-launch%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-text">2.1.5 .launch文件说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%87%E4%BB%A4"><span class="toc-text">2.1.6 文件系统指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-7-%E8%AE%A1%E7%AE%97%E5%9B%BE"><span class="toc-text">2.1.7 计算图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-ROS%E8%8A%82%E7%82%B9%E5%8F%8A%E5%87%BD%E6%95%B0"><span class="toc-text">2.3 ROS节点及函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-ROS%E8%8A%82%E7%82%B9"><span class="toc-text">2.3.1 ROS节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-node%E5%87%BD%E6%95%B0"><span class="toc-text">2.3.2 node函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ROS%E9%80%9A%E8%AE%AF"><span class="toc-text">3. ROS通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%AF%9D%E9%A2%98%E9%80%9A%E8%AE%AF"><span class="toc-text">3.1 话题通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.1.1 理论模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E8%AF%9D%E9%A2%98%E9%80%9A%E8%AE%AF%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C-C"><span class="toc-text">3.1.2 话题通讯简单操作 (C++)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="toc-text">3.1.3 自定义msg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%9D%E9%A2%98%E9%80%9A%E8%AE%AF-C"><span class="toc-text">3.1.4 自定义话题通讯 (C++)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9C%8D%E5%8A%A1%E9%80%9A%E8%AE%AF"><span class="toc-text">3.2 服务通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.2.1 理论模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E8%87%AA%E5%AE%9A%E4%B9%89srv"><span class="toc-text">3.2.2 自定义srv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E9%80%9A%E8%AE%AF-c"><span class="toc-text">3.2.3 自定义服务通讯 (c++)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%8F%82%E6%95%B0%E9%80%9A%E8%AE%AF"><span class="toc-text">3.3 参数通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.3.1 理论模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E5%8F%82%E6%95%B0%E9%80%9A%E8%AE%AF-c"><span class="toc-text">3.3.2 参数通讯 (c++)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3.4 常用命令</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/06/RTK%E7%9A%84%E4%BD%BF%E7%94%A8/" title="RTK的使用"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/rtk_imu.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RTK的使用"/></a><div class="content"><a class="title" href="/2024/08/06/RTK%E7%9A%84%E4%BD%BF%E7%94%A8/" title="RTK的使用">RTK的使用</a><time datetime="2024-08-06T09:40:59.000Z" title="发表于 2024-08-06 17:40:59">2024-08-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/15/navigation%E5%AF%BC%E8%88%AA/" title="navigation导航"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/navigation.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="navigation导航"/></a><div class="content"><a class="title" href="/2024/07/15/navigation%E5%AF%BC%E8%88%AA/" title="navigation导航">navigation导航</a><time datetime="2024-07-15T07:06:51.000Z" title="发表于 2024-07-15 15:06:51">2024-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/07/%E5%9F%BA%E4%BA%8ECubeIDE%E7%9A%84STM32%E5%BC%80%E5%8F%91/" title="基于CubeIDE的STM32开发"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/cubeide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于CubeIDE的STM32开发"/></a><div class="content"><a class="title" href="/2024/07/07/%E5%9F%BA%E4%BA%8ECubeIDE%E7%9A%84STM32%E5%BC%80%E5%8F%91/" title="基于CubeIDE的STM32开发">基于CubeIDE的STM32开发</a><time datetime="2024-07-07T05:01:46.000Z" title="发表于 2024-07-07 13:01:46">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/26/%E3%80%8A%E5%A4%A9%E5%AE%98%E8%B5%90%E7%A6%8F%E3%80%8B/" title="《天官赐福》"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/fu.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="《天官赐福》"/></a><div class="content"><a class="title" href="/2024/06/26/%E3%80%8A%E5%A4%A9%E5%AE%98%E8%B5%90%E7%A6%8F%E3%80%8B/" title="《天官赐福》">《天官赐福》</a><time datetime="2024-06-26T04:49:42.000Z" title="发表于 2024-06-26 12:49:42">2024-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/%E5%9F%BA%E4%BA%8EPCB%E7%9A%84%E8%AE%A1%E9%87%8F%E6%AF%94%E4%BE%8B%E6%BB%91%E5%8A%A8%E6%9D%A1%E8%AE%BE%E8%AE%A1/" title="基于PCB的计量比例滑动条设计"><img src="http://lancit.oss-cn-hangzhou.aliyuncs.com/img/blog/cover/slider.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于PCB的计量比例滑动条设计"/></a><div class="content"><a class="title" href="/2024/06/20/%E5%9F%BA%E4%BA%8EPCB%E7%9A%84%E8%AE%A1%E9%87%8F%E6%AF%94%E4%BE%8B%E6%BB%91%E5%8A%A8%E6%9D%A1%E8%AE%BE%E8%AE%A1/" title="基于PCB的计量比例滑动条设计">基于PCB的计量比例滑动条设计</a><time datetime="2024-06-20T14:39:07.000Z" title="发表于 2024-06-20 22:39:07">2024-06-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: #87CEFA"><div id="footer-wrap"><div class="copyright">&copy;2024 By lancit</div><div class="footer_custom_text">书山有路勤为径，学海无涯苦作舟。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>